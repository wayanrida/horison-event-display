<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Horison Lampung â€“ Event Display</title>
  <style>
    body, html { margin:0; height:100%; background:#000; font-family: Arial, sans-serif; }

    .stage-wrap { display:grid; place-items:center; height:100%; }
    .stage { position:relative; width:1920px; height:1080px; background:#222; overflow:hidden; }

    .bg { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:0; }

    .header-date {
      position:absolute; right:250px; top:60px;
      background:#444; color:#fff; font-weight:800;
      font-size:42px; padding:14px 40px;
      border-radius:50px; text-transform:uppercase;
    }

    .clock {
      position:absolute; right:50px; top:60px;
      background:#c5aa72; color:#000; font-weight:800;
      font-size:36px; padding:14px 30px;
      border-radius:50px;
    }

    .table-wrap {
      position:absolute; left:180px; right:180px; top:300px;
      display:grid; grid-template-rows:90px 1fr; z-index:2;
    }

    .table-head {
      display:grid; grid-template-columns:1.2fr 2fr 1.5fr; gap:18px;
    }
    .th {
      background:#c5aa72; color:#000; font-weight:800;
      font-size:32px; display:grid; place-items:center;
      border-radius:20px;
    }

    .table-body { display:grid; grid-auto-rows:95px; gap:18px; margin-top:12px; }
    .row { display:grid; grid-template-columns:1.2fr 2fr 1.5fr; gap:18px; }

    .cell {
      background:linear-gradient(180deg,#2f2f31 0%,#1f1f21 100%);
      color:#fff; font-weight:700; font-size:clamp(20px,2vw,32px);
      border-radius:18px; display:grid; place-items:center;
      padding:0 16px; text-align:center;
    }

    .is-room { text-align:right; justify-items:end; }
  </style>
</head>
<body>
  <div class="stage-wrap">
    <div class="stage">
      <img class="bg" src="background-1920x1080.png" alt="bg"/>

      <div class="header-date" id="headerDate">EVENT HARI INI</div>
      <div class="clock" id="clock">00:00:00</div>

      <div class="table-wrap">
        <div class="table-head">
          <div class="th">TIME</div>
          <div class="th">EVENT</div>
          <div class="th">ROOM</div>
        </div>
        <div class="table-body" id="rows"></div>
      </div>
    </div>
  </div>

<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT7JWjVeETxcC1epq9wg5oLA8C-BT7iNTCW6mAHfKjMNWe0LI_Ns2srMwOFsdBQE_bIYwKqq7xVoMLU/pub?gid=974824918&single=true&output=csv";
  const REFRESH_MS = 30000;
  let lastData = [];

  function parseCSV(text) {
    const lines = text.trim().split("\n");
    return lines.map(line => {
      // hapus tanda kutip di awal/akhir kalau ada
      line = line.replace(/^"|"$/g, "");
      const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // split koma tapi aman untuk kutipan
      return parts.map(p => p.replace(/^"|"$/g,"").trim());
    });
  }

  function renderRows(data){
    const wrap=document.getElementById("rows");
    wrap.innerHTML='';
    data.forEach(([time,event,room])=>{
      const row=document.createElement("div");
      row.className="row";
      row.innerHTML=`
        <div class="cell">${time||""}</div>
        <div class="cell">${event||""}</div>
        <div class="cell is-room">${room||""}</div>`;
      wrap.appendChild(row);
    });
  }

  async function loadAndRender(){
    try {
      const resp=await fetch(CSV_URL+"&_ts="+Date.now(),{cache:"no-store"});
      const text=await resp.text();
      const rows=parseCSV(text);
      const body=rows.slice(1).filter(r=>(r[0]||r[1]||r[2]));
      if(body.length>0){ lastData=body; }
      renderRows(lastData);
      const opts={day:"2-digit",month:"long",year:"numeric"};
      document.getElementById("headerDate").textContent="EVENT "+new Date().toLocaleDateString("id-ID",opts).toUpperCase();
    } catch(e){
      console.error("Fetch gagal:",e);
      renderRows(lastData);
    }
  }

  function tickClock(){
    const now=new Date();
    const opts={hour:"2-digit",minute:"2-digit",second:"2-digit"};
    document.getElementById("clock").textContent=now.toLocaleTimeString("id-ID",opts);
  }

  loadAndRender();
  setInterval(loadAndRender,REFRESH_MS);
  tickClock();
  setInterval(tickClock,1000);
</script>
</body>
</html>
